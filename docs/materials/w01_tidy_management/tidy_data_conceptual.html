<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Hallquist, PSYC 859">
<meta name="dcterms.date" content="2026-01-07">

<title>Tidy data overview – Data Management and Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-203898e0a995a1603b190edd51f3a64a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../../rmd_style.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PSYC 859</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../materials.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#data-structure-semantics" id="toc-data-structure-semantics" class="nav-link active" data-scroll-target="#data-structure-semantics">Data structure semantics</a>
  <ul class="collapse">
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#observations" id="toc-observations" class="nav-link" data-scroll-target="#observations">Observations</a></li>
  </ul></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy data</a>
  <ul class="collapse">
  <li><a href="#tidying-verbs" id="toc-tidying-verbs" class="nav-link" data-scroll-target="#tidying-verbs">Tidying verbs</a></li>
  </ul></li>
  <li><a href="#data-tidying-examples" id="toc-data-tidying-examples" class="nav-link" data-scroll-target="#data-tidying-examples">Data tidying examples</a>
  <ul class="collapse">
  <li><a href="#pivot_longer-example" id="toc-pivot_longer-example" class="nav-link" data-scroll-target="#pivot_longer-example">pivot_longer example</a></li>
  <li><a href="#pivot_wider-example" id="toc-pivot_wider-example" class="nav-link" data-scroll-target="#pivot_wider-example">pivot_wider example</a></li>
  <li><a href="#missingness-implicit-vs-explicit" id="toc-missingness-implicit-vs-explicit" class="nav-link" data-scroll-target="#missingness-implicit-vs-explicit">Missingness: implicit vs explicit</a></li>
  <li><a href="#separate-example" id="toc-separate-example" class="nav-link" data-scroll-target="#separate-example">separate example</a></li>
  <li><a href="#unite-example" id="toc-unite-example" class="nav-link" data-scroll-target="#unite-example">unite example</a></li>
  </ul></li>
  <li><a href="#advanced-reshaping" id="toc-advanced-reshaping" class="nav-link" data-scroll-target="#advanced-reshaping">Advanced reshaping</a>
  <ul class="collapse">
  <li><a href="#data.table-meltdcast" id="toc-data.table-meltdcast" class="nav-link" data-scroll-target="#data.table-meltdcast">data.table melt/dcast</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidy data overview</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Hallquist, PSYC 859 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 7, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="data-structure-semantics" class="level1">
<h1>Data structure semantics</h1>
<p>Most data wrangling can be accomplished using <code>data.frame</code> object (or <code>tbl</code> objects in <code>dplyr</code>). These objects consist of rows and columns, forming a rectangular structure.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">kable_table</span>(<span class="at">n=</span><span class="dv">6</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">continent</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lifeExp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1952</td>
<td style="text-align: right;">28.801</td>
<td style="text-align: right;">8425333</td>
<td style="text-align: right;">779.4453</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1957</td>
<td style="text-align: right;">30.332</td>
<td style="text-align: right;">9240934</td>
<td style="text-align: right;">820.8530</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">31.997</td>
<td style="text-align: right;">10267083</td>
<td style="text-align: right;">853.1007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1967</td>
<td style="text-align: right;">34.020</td>
<td style="text-align: right;">11537966</td>
<td style="text-align: right;">836.1971</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1972</td>
<td style="text-align: right;">36.088</td>
<td style="text-align: right;">13079460</td>
<td style="text-align: right;">739.9811</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">38.438</td>
<td style="text-align: right;">14880372</td>
<td style="text-align: right;">786.1134</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>A <strong>variable</strong> contains all values measuring an attribute (e.g., neuroticism) across units (e.g., people).</p>
<p>Columns in data.frames are typically labeled and represent variables.</p>
<p>Moreover, in a data.frame, all values in a given column should have the same <strong>data type</strong>, such as character strings. But a <code>data.frame</code> is different from a <code>matrix</code> object because columns can differ in terms of data type. For example, in the <code>gapminder</code>, the <code>country</code> column is a factor, whereas <code>lifeExp</code> is a numeric column.</p>
<p>“A data frame is a list of vectors that R displays as a table. When your data is tidy, the values of each variable fall in their own column vector.” -Garrett Grolemund <a href="http://garrettgman.github.io/tidying/">Citation</a></p>
</section>
<section id="observations" class="level2">
<h2 class="anchored" data-anchor-id="observations">Observations</h2>
<p>An <strong>observation</strong> contains all values measured on the same unit across attributes.</p>
<p><em>Rows in a data.frame typically represent observations.</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">kable_table</span>(<span class="at">n=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">continent</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lifeExp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">1952</td>
<td style="text-align: right;">28.801</td>
<td style="text-align: right;">8425333</td>
<td style="text-align: right;">779.4453</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="tidy-data" class="level1">
<h1>Tidy data</h1>
<p><strong>Features of tidy data:</strong></p>
<ol type="1">
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each type of observational unit (e.g., persons, schools, counties) forms a table.</li>
</ol>
<p>Furthermore, variables that are part of the design (participant number, experimental condition, county ID, etc.), or that may be key categorical moderators, should typically be placed first (columns to the left), and measured variables thereafter (columns to the right).</p>
<p>This sounds easy, right?! But in truth, we have all seen data that look more like this:</p>
<pre><code>0.6226  WARNING     Movie2 stim could not be imported and won't be available
17.6226     DATA    version J
102.5349    DATA    Keypress: space
110.4876    DATA    Keypress: v
110.6203    DATA    Keypress: v
111.0859    DATA    Keypress: v
112.6459    DATA    Keypress: t
116.4982    DATA    Keypress: v
118.5406    DATA    Keypress: v</code></pre>
<p>For a more detailed treatment of tidy data, see: <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html" class="uri">https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html</a></p>
<section id="tidying-verbs" class="level2">
<h2 class="anchored" data-anchor-id="tidying-verbs">Tidying verbs</h2>
<p>The <code>tidyr</code> package provides four core functions to aid in converting messy data into tidy form. We may also need functions from <code>dplyr</code> at times. Each of these verbs is also a function that transforms the dataset with the goal of making it more tidy.</p>
<ol type="1">
<li><strong>Pivot_longer</strong>: combine multiple columns into a single column with a key-value pair format</li>
<li><strong>Pivot_wider</strong>: divide key-value rows into multiple columns</li>
<li><strong>Separate</strong>: split a single variable into multiple variables by pulling apart the values into pieces</li>
<li><strong>Unite</strong>: merge two variables (columns) into one, effectively pasting together the values</li>
</ol>
<p><strong>Note</strong>: <code>pivot_longer</code> and <code>pivot_wider</code> are complements. And <code>separate</code> and <code>unite</code> are complements.</p>
<p>Details about the pivot functions can be found here: <a href="https://tidyr.tidyverse.org/articles/pivot.html" class="uri">https://tidyr.tidyverse.org/articles/pivot.html</a>.</p>
<p>Let’s look at a series of datasets (from Wickham 2014) and consider how tidy or messy they are.</p>
</section>
</section>
<section id="data-tidying-examples" class="level1">
<h1>Data tidying examples</h1>
<section id="pivot_longer-example" class="level2">
<h2 class="anchored" data-anchor-id="pivot_longer-example">pivot_longer example</h2>
<p>Here is our first mess. Notice that the column headers are values, not variable names. This is untidy and hard to look at. We effectively have the data in a cross-tabulated format, but <code>religion</code> and <code>income</code> are not variables in the dataset.</p>
<section id="messy-version" class="level3">
<h3 class="anchored" data-anchor-id="messy-version">Messy version</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">religion</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">&lt;$10k</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">$10-20k</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">$20-30k</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">$30-40k</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">$40-50k</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">$50-75k</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">137</td>
</tr>
<tr class="even">
<td style="text-align: left;">Atheist</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Buddhist</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">58</td>
</tr>
<tr class="even">
<td style="text-align: left;">Catholic</td>
<td style="text-align: right;">418</td>
<td style="text-align: right;">617</td>
<td style="text-align: right;">732</td>
<td style="text-align: right;">670</td>
<td style="text-align: right;">638</td>
<td style="text-align: right;">1116</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don’t know/refused</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">Evangelical Prot</td>
<td style="text-align: right;">575</td>
<td style="text-align: right;">869</td>
<td style="text-align: right;">1064</td>
<td style="text-align: right;">982</td>
<td style="text-align: right;">881</td>
<td style="text-align: right;">1486</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hindu</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">34</td>
</tr>
<tr class="even">
<td style="text-align: left;">Historically Black Prot</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">244</td>
<td style="text-align: right;">236</td>
<td style="text-align: right;">238</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jehovah's Witness</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jewish</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">95</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidy-version" class="level3">
<h3 class="anchored" data-anchor-id="tidy-version">Tidy version</h3>
<p>In the tidy version, religion and income become variables, and the number of observations in each religion x income combination is a frequency column. This is now tidy insofar as each <strong>value</strong> in the frequency column represents a unique combination of the religion and income factors, which are coded as variables.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">religion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">income</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$10-20k</td>
<td style="text-align: right;">34</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$100-150k</td>
<td style="text-align: right;">109</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$20-30k</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$30-40k</td>
<td style="text-align: right;">81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$40-50k</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$50-75k</td>
<td style="text-align: right;">137</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">$75-100k</td>
<td style="text-align: right;">122</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">&lt;$10k</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">&gt;150k</td>
<td style="text-align: right;">84</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agnostic</td>
<td style="text-align: left;">Don't know/refused</td>
<td style="text-align: right;">96</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidying-solution" class="level3">
<h3 class="anchored" data-anchor-id="tidying-solution">Tidying solution</h3>
<p>To achieve the above transformation, we want to <strong>pivot_longer</strong> the many columns of income into a single income column.</p>
<pre><code>tidy1 &lt;- mess1 %&gt;% pivot_longer(cols=-religion, names_to="income", values_to="freq")</code></pre>
<p>Here, we tell <code>tidyr</code> that we wish to create a lookup (‘key’) column called <code>income</code> whose correponding values will be called <code>freq</code> (here, representing the frequency of this religion x income combination). Furthermore, as additional arguments to <code>pivot_longer</code>, we provide the columns (<code>cols</code> argument) that should be combined, representing levels of the key variable. By specifying <code>-religion</code>, we are saying ‘all columns except religion.’ The alternative would be to provide a comma-separate list of columns like this <code>mess1 %&gt;% pivot_longer(names_to="income", values_to="freq", cols=c("&lt;$10k", "$10-20k", etc.))</code></p>
</section>
</section>
<section id="pivot_wider-example" class="level2">
<h2 class="anchored" data-anchor-id="pivot_wider-example">pivot_wider example</h2>
<p>In our second mess, we have a weather dataset from the Global Historical Climatology Network for one weather station (MX17004) in Mexico. The data represent minimum and maximum temperatures measured across 31 days for five months. The days within each month are on the columns, the months are encoded as a variable <code>month</code>, and the min and max temperatures are separated by row, as identified by the <code>element</code> variable.</p>
<section id="messy-version-1" class="level3">
<h3 class="anchored" data-anchor-id="messy-version-1">Messy version</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show a subset of columns that fit on the page</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mess2 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(id<span class="sc">:</span>d13) <span class="sc">%&gt;%</span> <span class="fu">kable_table</span>(<span class="at">n=</span><span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">month</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">element</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d5</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d6</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d7</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d8</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">d9</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d10</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d11</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">d12</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">tmax</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">tmin</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">tmax</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">24.1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">tmin</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.4</td>
<td style="text-align: right;">14.4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">tmax</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">32.1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">tmin</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">16.8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">tmax</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">tmin</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidy-version-1" class="level3">
<h3 class="anchored" data-anchor-id="tidy-version-1">Tidy version</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tmin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">27.8</td>
<td style="text-align: right;">14.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">14.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">24.1</td>
<td style="text-align: right;">14.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">29.9</td>
<td style="text-align: right;">10.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">32.1</td>
<td style="text-align: right;">14.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: right;">16.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">MX17004</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">31.1</td>
<td style="text-align: right;">17.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidying-solution-1" class="level3">
<h3 class="anchored" data-anchor-id="tidying-solution-1">Tidying solution</h3>
<p>To clean this up, we need to bring all of the day columns together using <code>pivot_longer</code> so that we can encode <code>day</code> as a variable and <code>temperature</code> as a variable.</p>
<p>We also may want to have max and min temperature as separate columns (i.e., variables), rather than keeping that as a key-value pair. That is, the <code>tmin</code> and <code>tmax</code> values denote the attributes of a single observation, which would usually be represented as separate variables in tidy format. To obtain min and max temperatures as separate columns, we use <code>pivot_wider</code> to move the <code>element</code> values onto separate columns.</p>
<p>Here is the basic approach:</p>
<pre><code>#use num_range() to select variables called d1--d31
tidy2 &lt;- mess2 %&gt;% 
  pivot_longer(
    cols = num_range("d", 1:31), 
    names_to = "day", 
    values_to = "temperature",
    names_prefix = "d", #trim off the 'd'
    names_transform = list(day = as.integer)
  ) %&gt;%
  pivot_wider(names_from = "element", values_from = "temperature") %&gt;%
  na.omit()</code></pre>
<p>Notice that <code>pivot_longer</code> has a few built-in arguments for helping us trim off parts of the column names that are not data per se. Here, we have d1–d31, but only the numeric part of that is data. The <code>names_prefix="d"</code> tells <code>pivot_longer</code> to trim the leading ‘d’ from every value in the <code>day</code> column. The <code>names_transform=list(day=as.integer)</code> argument then converts the resulting <code>day</code> values to integers so they behave like a numeric variable rather than text.</p>
<p>Here, <code>pivot_wider</code> a key – <code>element</code> – that has values <code>'tmin'</code> or <code>'tmax'</code> and puts the values of these rows onto columns. This is a kind of ‘long-to-wide’ conversion and we would expect here for the number of rows in the dataset drop two-fold with the <code>pivot_wider</code> compared to the preceding step where we’ve gathered the day columns.</p>
<p>It is often useful to check the number of rows after each step in a data transformation pipeline. Here, I just break up the pipeline into the pivot_longer and pivot_wider steps and check the structure in between.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tidy2<span class="fl">.1</span> <span class="ot">&lt;-</span> mess2 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">num_range</span>(<span class="st">"d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">31</span>), <span class="at">names_to =</span> <span class="st">"day"</span>, <span class="at">values_to =</span> <span class="st">"temperature"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"d"</span>, <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">day =</span> as.integer)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tidy2<span class="fl">.1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 682</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tidy2<span class="fl">.2</span> <span class="ot">&lt;-</span> tidy2<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"element"</span>, <span class="at">values_from =</span> <span class="st">"temperature"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with NAs included (since data are sparse), we get the expected 50% reduction in rows</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tidy2<span class="fl">.2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 341</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># there are only 33 useful/present observations</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tidy2<span class="fl">.2</span> <span class="sc">%&gt;%</span> na.omit)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33</code></pre>
</div>
</div>
</section>
</section>
<section id="missingness-implicit-vs-explicit" class="level2">
<h2 class="anchored" data-anchor-id="missingness-implicit-vs-explicit">Missingness: implicit vs explicit</h2>
<p>Tidy data often needs missing values made explicit (or dropped) so analyses behave as intended.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tidy_missing <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>day, <span class="sc">~</span>score,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">"Mon"</span>, <span class="dv">10</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">"Wed"</span>, <span class="dv">8</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">"Mon"</span>, <span class="dv">9</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">"Mon"</span>, <span class="cn">NA_real_</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows where all pivoted values are NA</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>tidy_missing <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"day"</span>, <span class="at">values_from =</span> <span class="st">"score"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="sc">-</span>id, is.na))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">Mon</th>
<th style="text-align: right;">Wed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make implicit missing combinations explicit</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tidy_missing <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">complete</span>(id, day)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">day</th>
<th style="text-align: right;">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill down within a group (e.g., carry forward metadata). Grouping ensures we</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># only fill within each id; ungroup to avoid carrying this into later steps.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>tidy_missing <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">complete</span>(id, day) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">fill</span>(score, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">day</th>
<th style="text-align: right;">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Wed</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="separate-example" class="level2">
<h2 class="anchored" data-anchor-id="separate-example">separate example</h2>
<p>In our third mess, we have multiple variables stored in one column. More specifically, in these data, the ‘m014’ etc. columns represent a combination of sex (m/f) and age range (e.g., 014 is 0–14). The country and year columns are ‘tidy’ because they represent variables, but the sex + age columns are not.</p>
<section id="messy-version-2" class="level3">
<h3 class="anchored" data-anchor-id="messy-version-2">Messy version</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use select to select a few columns that can fit on the page</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mess3 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(country<span class="sc">:</span>f1524) <span class="sc">%&gt;%</span> <span class="fu">kable_table</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m014</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m1524</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m2534</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m3544</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m4554</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m5564</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">m65</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mu</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">f014</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">f1524</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">AE</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AF</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">414</td>
</tr>
<tr class="even">
<td style="text-align: left;">AG</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidy-version-2" class="level3">
<h3 class="anchored" data-anchor-id="tidy-version-2">Tidy version</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">age_range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AE</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AF</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">AG</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">AM</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AN</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AO</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">186</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidying-solution-2" class="level3">
<h3 class="anchored" data-anchor-id="tidying-solution-2">Tidying solution</h3>
<p>We essentially need to parse apart the ‘m’ from the ‘014’ components of each value, which is a job for <code>separate</code>. Note that we also need to <code>pivot_longer</code> the wacky sex + age columns first to make this easier. Here I use <code>cols=c(-country, -year)</code> to say, ‘all columns except these.’</p>
<p>The <code>sep</code> argument of <code>separate</code> tells <em>R</em> how to split the values into multiple variables. Here, by using the number <code>1</code>, we ask for the first character to become <code>sex</code> and the rest to become <code>age_range</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tidy3 <span class="ot">&lt;-</span> mess3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to=</span><span class="st">"sex_age"</span>, <span class="at">values_to=</span><span class="st">"freq"</span>, <span class="at">cols=</span><span class="fu">c</span>(<span class="sc">-</span>country, <span class="sc">-</span>year)) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(sex_age, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"age_range"</span>), <span class="at">sep=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Here, we gathered all columns except <code>country</code> and <code>year</code> into a single key-value pair using <code>pivot_longer</code>. This is an intermediate stage of the dataset that is semi-tidy. We then <code>separate</code> the sex and age components of the values into different variables, resulting in a tidy dataset.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">age_range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">014</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">1524</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">2534</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">3544</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">4554</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">5564</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">65</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">u</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is pretty close. The <code>age_range</code> variable is still a little clunky because it isn’t easy to read. We could modify this further using <code>mutate</code> and <code>recode</code> from <code>dplyr</code>, but that’s not the immediate emphasis here.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tidy3 <span class="ot">&lt;-</span> tidy3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age_range=</span><span class="fu">recode</span>(age_range,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"014"</span><span class="ot">=</span><span class="st">"0-14"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"1524"</span><span class="ot">=</span><span class="st">"15-24"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"2534"</span><span class="ot">=</span><span class="st">"25-34"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"3544"</span><span class="ot">=</span><span class="st">"35-44"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"4554"</span><span class="ot">=</span><span class="st">"45-54"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"5564"</span><span class="ot">=</span><span class="st">"55-64"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"65"</span><span class="ot">=</span><span class="st">"65+"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"u"</span><span class="ot">=</span><span class="st">"unknown"</span>, <span class="at">.default=</span><span class="cn">NA_character_</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="modern-separate_-alternatives" class="level3">
<h3 class="anchored" data-anchor-id="modern-separate_-alternatives">Modern <code>separate_*</code> alternatives</h3>
<p>For simple string splitting, <code>tidyr</code> now provides <code>separate_wider_delim()</code> (split on a delimiter) and <code>separate_wider_regex()</code> (split using a regex). These are often clearer than <code>separate()</code> because they create named columns directly.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>toy_people <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">person =</span> <span class="fu">c</span>(<span class="st">"Ada-Lovelace"</span>, <span class="st">"Grace-Hopper"</span>, <span class="st">"Katherine-Johnson"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>toy_people <span class="sc">%&gt;%</span> <span class="fu">separate_wider_delim</span>(person, <span class="at">delim =</span> <span class="st">"-"</span>, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"first"</span>, <span class="st">"last"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">first</th>
<th style="text-align: left;">last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ada</td>
<td style="text-align: left;">Lovelace</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grace</td>
<td style="text-align: left;">Hopper</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Katherine</td>
<td style="text-align: left;">Johnson</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>toy_people <span class="sc">%&gt;%</span> <span class="fu">separate_wider_regex</span>(person, <span class="at">patterns =</span> <span class="fu">c</span>(<span class="at">first =</span> <span class="st">"^[^-]+"</span>, <span class="st">"-"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">last =</span> <span class="st">"[^-]+$"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">first</th>
<th style="text-align: left;">last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ada</td>
<td style="text-align: left;">Lovelace</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grace</td>
<td style="text-align: left;">Hopper</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Katherine</td>
<td style="text-align: left;">Johnson</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="tidying-solution-using-pivot_longer-alone" class="level3">
<h3 class="anchored" data-anchor-id="tidying-solution-using-pivot_longer-alone">Tidying solution using pivot_longer alone</h3>
<p>I am ambivalent about whether it is useful to combine separable objectives into a single data wrangling verb. Nevertheless, I want to note that the <code>pivot_longer</code> function provides added functionality for both combining columns into a key-value pair format <em>and</em> splitting the key into multiple variables if the key variable is an amalgamation of discrete variables. This can allow us to skip the <code>separate</code> step:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tidy3 <span class="ot">&lt;-</span> mess3 <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>country, <span class="sc">-</span>year), </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"age_range"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.)(.*)"</span>, <span class="co">#first character versus the rest</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"freq"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_ptypes =</span> <span class="fu">list</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_range=</span><span class="fu">factor</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"u"</span>, <span class="st">"014"</span>, <span class="st">"1524"</span>, <span class="st">"2534"</span>, <span class="st">"3544"</span>, <span class="st">"4554"</span>, <span class="st">"5564"</span>, <span class="st">"65"</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ordered=</span><span class="cn">TRUE</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: we can't adjust the labels in the names_ptype above using labels=c(...).</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Thus, we'd need to use recode_factor, similar to the above</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>tidy3 <span class="ot">&lt;-</span> tidy3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_range=</span><span class="fu">recode_factor</span>(age_range,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"014"</span><span class="ot">=</span><span class="st">"0-14"</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"1524"</span><span class="ot">=</span><span class="st">"15-24"</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"2534"</span><span class="ot">=</span><span class="st">"25-34"</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"3544"</span><span class="ot">=</span><span class="st">"35-44"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"4554"</span><span class="ot">=</span><span class="st">"45-54"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"5564"</span><span class="ot">=</span><span class="st">"55-64"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"65"</span><span class="ot">=</span><span class="st">"65+"</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"u"</span><span class="ot">=</span><span class="st">"unknown"</span>, <span class="at">.default=</span><span class="cn">NA_character_</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>tidy3 <span class="sc">%&gt;%</span> <span class="fu">kable_table</span>(<span class="at">n=</span><span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">age_range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">0-14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">15-24</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">25-34</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">35-44</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">45-54</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">55-64</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">65+</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AD</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">unknown</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="unite-example" class="level2">
<h2 class="anchored" data-anchor-id="unite-example">unite example</h2>
<p>Although the least common of the tidying verbs (in my experience), <code>unite</code> is the complement to separate and can be used to bring together multiple variables that we wish to store as a single variable. For example, we may have first name and last name stored in separate variables, but wish to put them together for display or exporting purposes. Sometimes, we also use <code>unite</code> as an intermediate stage in tidying, bringing together variables, reshaping the data, then re-separating them.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">first_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">last_name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">favorite_color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Graham</td>
<td style="text-align: left;">Doe</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Purple</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kieran</td>
<td style="text-align: left;">Helali</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Blue</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Charlotte</td>
<td style="text-align: left;">Stafford</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Pink</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="tidying-solution-3" class="level3">
<h3 class="anchored" data-anchor-id="tidying-solution-3">Tidying solution</h3>
<p>If we wanted to have a <code>full_name</code>, we could use <code>unite</code> to combine <code>first_name</code> and <code>last_name</code> and then get rid of those individual columns.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df4_united <span class="ot">&lt;-</span> df4 <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"full_name"</span>, first_name, last_name, <span class="at">sep=</span><span class="st">" "</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">full_name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">favorite_color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Graham Doe</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Purple</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kieran Helali</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Blue</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Charlotte Stafford</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Pink</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="advanced-reshaping" class="level1">
<h1>Advanced reshaping</h1>
<section id="data.table-meltdcast" class="level2">
<h2 class="anchored" data-anchor-id="data.table-meltdcast">data.table melt/dcast</h2>
<p>The <code>data.table</code> package provides <code>melt()</code> and <code>dcast()</code> for fast reshaping. The formula interface is compact for multi-way summary tables, and <code>dcast()</code> can aggregate on the fly while casting.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y2022 =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">11</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y2023 =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">10</span>, <span class="dv">12</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">z2022 =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">90</span>, <span class="dv">110</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">z2023 =</span> <span class="fu">c</span>(<span class="dv">130</span>, <span class="dv">140</span>, <span class="dv">95</span>, <span class="dv">115</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>long_dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  dt,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"group"</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure.vars =</span> <span class="fu">patterns</span>(<span class="st">"^y"</span>, <span class="st">"^z"</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable.name =</span> <span class="st">"year"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">"y"</span>, <span class="st">"z"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Map pattern indices to actual year labels.</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>long_dt<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2022"</span>, <span class="st">"2023"</span>)[<span class="fu">as.integer</span>(long_dt<span class="sc">$</span>year)]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>long_dt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">group</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">120</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">B</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">90</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">B</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">110</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">130</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">140</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">B</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">95</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">B</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">115</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mean_y <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  long_dt,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  group <span class="sc">~</span> year,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"y"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> mean</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>mean_y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">2022</th>
<th style="text-align: right;">2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mean_multi <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  long_dt,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  group <span class="sc">~</span> year,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> mean</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>mean_multi</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">y_2022</th>
<th style="text-align: right;">y_2023</th>
<th style="text-align: right;">z_2022</th>
<th style="text-align: right;">z_2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">13.5</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">105</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Compared with <code>tidyr</code>, <code>data.table::dcast()</code> makes aggregation part of the casting step and can cast multiple value columns in one pass. It is also a common choice for very large tables where performance matters.</p>
<p>Further reshaping extensions using data.table package: <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>